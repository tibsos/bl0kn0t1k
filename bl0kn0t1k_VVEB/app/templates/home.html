{% load static %}
{% load compress %}

<!DOCTYPE html>

<html>

    <head>

        <meta charset="utf-8" /> 

        <script src="{% static 'packages/jquery-3.6.1.min.js' %}"></script>
        <script src="{% static 'packages/htmx.min.js' %}"></script>
        <script src="{% static 'packages/iconify.min.js' %}"></script>

        {% compress css %}

            <link rel="stylesheet" href="{% static 'scss/app/home.scss' %}" type="text/x-scss">

        {% endcompress %}

    </head>
    
    <body>

        <div class="everything">

                <!-- Profile dropdown -->

            <div class="profile-dropdown">

                <div class="buttons">

                    <a href="#">

                        <div class="btn" id="myAccount">

                            <svg style="left: 15px;" xmlns="http://www.w3.org/2000/svg" width="23.339" height="23.34" viewBox="0 0 23.339 23.34">
                                <path id="Icon_ionic-ios-person" data-name="Icon ionic-ios-person" d="M27.828,27.251c-.438-1.933-2.936-2.875-3.8-3.179a28.323,28.323,0,0,0-3.167-.608,3.218,3.218,0,0,1-1.465-.675,12.8,12.8,0,0,1-.1-3,9.016,9.016,0,0,0,.693-1.319,17.013,17.013,0,0,0,.511-2.3s.5,0,.675-.875a8.612,8.612,0,0,0,.45-2.036c-.036-.7-.419-.681-.419-.681a10.657,10.657,0,0,0,.413-3.118c.055-2.5-1.9-4.96-5.446-4.96-3.592,0-5.507,2.462-5.452,4.96a11.116,11.116,0,0,0,.407,3.118s-.383-.018-.419.681a8.612,8.612,0,0,0,.45,2.036c.17.875.675.875.675.875a17.013,17.013,0,0,0,.511,2.3,9.016,9.016,0,0,0,.693,1.319,12.8,12.8,0,0,1-.1,3,3.218,3.218,0,0,1-1.465.675,28.323,28.323,0,0,0-3.167.608c-.863.3-3.361,1.246-3.8,3.179a.486.486,0,0,0,.48.59H27.354A.485.485,0,0,0,27.828,27.251Z" transform="translate(-4.501 -4.5)"/>
                            </svg>
        
                            <span>Мой аккаунт</span>
                        
                        </div>

                    </a>

                    <a href="{% url 'user:logout' %}">

                        <div class="btn" id="logout">

                            <svg style="fill: red;" xmlns="http://www.w3.org/2000/svg" width="28.618" height="27.77" viewBox="0 0 28.618 27.77">
                                <path id="Icon_open-account-logout" data-name="Icon open-account-logout" d="M9.606-1.086c-4,.8-3.2,2.4,0,3.2s9.606-4,12.808,0,3.2,12.007,0,16.01-9.606-.8-12.808,0-4,2.4,0,3.2,12.007,5.6,16.01,0,4-16.81,0-22.414S13.608-1.886,9.606-1.086Zm-3.2,6.4c-1.6.4-6.4,2.4-6.4,4.8s4.8,4.4,6.4,4.8,0-3.2,0-3.2,9.606.8,12.808,0,3.2-2.4,0-3.2S6.4,8.52,6.4,8.52,8,4.918,6.4,5.318Z" transform="translate(0 3.764)"/>
                            </svg>
        
                            <span style="color: red;">Выйти</span>
                        
                        </div>

                    </a>

                </div>

            </div>

            <!-- Forms -->
            
            <div class="create-folder">

                <div class="wrapper">

                    <button id="closeNewFolderForm">×</button>

                    <span class="form-title">Новый блокнотик</span>

                    <form>

                        <input 
                            type="text"
                            name="t"
                            id="newFolderTitle"
                            placeholder="Заголовок">

                        <button 
                            type="submit" 
                            class="create-folder-btn"
                            hx-post="{% url 'app:create-folder' %}"
                            hx-target=".folders">Создать</button>

                    </form>

                </div>

            </div>
            
            <div class="edit-folder">

                <div class="wrapper">

                    <button id="closeEditFolderForm">×</button>

                    <span class="form-title">Редактировать блокнотик</span>

                    <div class="form">

                        <input 
                            type="text"
                            id="editFolderTitle"
                            placeholder="Заголовок">

                        <button 
                            type="submit" 
                            class="edit-folder-btn">Сохранить</button>

                    </div>

                    <!-- htmx deletion form -->
                    <form>

                        <input 
                            type="text"
                            name="f"
                            id="deleteFolderUID"
                            hidden />

                        <button 
                            class="delete-folder-btn"
                            hx-post="{% url 'app:delete-folder' %}"
                            hx-target=".folders">

                            <svg xmlns="http://www.w3.org/2000/svg" width="18.008" height="24.68" viewBox="0 0 18.008 24.68">
                                <g id="Icon_ionic-ios-trash" data-name="Icon ionic-ios-trash" transform="translate(-8.297 -4.5)">
                                <path id="Контур_3" data-name="Контур 3" d="M9.359,9l1.525,20.44a1.981,1.981,0,0,0,1.894,2.06h9.114a1.981,1.981,0,0,0,1.894-2.06L25.292,9ZM13.34,27.633,12.907,11.25h1.2l.446,16.383Zm4.544,0H16.721V11.25h1.164Zm3.381,0h-1.2L20.5,11.25h1.2Z" transform="translate(0 -2.32)"/>
                                <path id="Контур_4" data-name="Контур 4" d="M24.347,6.469H22L20.283,4.852a1.269,1.269,0,0,0-.861-.352H15.193a1.288,1.288,0,0,0-.874.352L12.6,6.469H10.254A1.733,1.733,0,0,0,8.3,8.3H26.3A1.733,1.733,0,0,0,24.347,6.469Z"/>
                                </g>
                            </svg>

                        </button>

                    </form>

                </div>

            </div>

            <!-- Current note photo carousel -->
            <div class="photo-carousel">
                
                <button id="closePhoto">×</button>

                <button id="previousPhoto">P</button>
                <button id="nextPhoto">N</button>
            
            </div>

            <!-- Current note -->
            <div class="current-note">

                <div class="wrapper" id="currentNoteWrapper">

                    <div class="top">
                        
                        <input type="text" placeholder="Заголовок" class="current-note-title">

                        <button type="button" id="closeCurrentNote">×</button>
                    
                    </div>

                    <div class="photos" id="photosCurrent">

                        {% include 'components/current-note-photos.html' %}

                    </div>

                    <div class="rte">

                        <div class="left">

                            <button id="boldBtnCurrent"><b>Ж</b></button>
                            <button id="italicBtnCurrent"><i>К</i></button>
                            <button id="underlineBtnCurrent"><u>С</u></button>
                            <button id="strikeBtnCurrent"><s>О</s></button>
                            
                            <button id="ulBtnCurrent">

                                <svg xmlns="http://www.w3.org/2000/svg" width="23.798" height="18.84" viewBox="0 0 23.798 18.84">
                                    <g id="Icon_ionic-ios-list" data-name="Icon ionic-ios-list" transform="translate(-4.5 -7.313)">
                                    <path id="Контур_1" data-name="Контур 1" d="M7.971,17.767a1.735,1.735,0,1,1-1.735-1.735A1.735,1.735,0,0,1,7.971,17.767Z" transform="translate(0 -1.034)"/>
                                    <path id="Контур_2" data-name="Контур 2" d="M7.971,9.048A1.735,1.735,0,1,1,6.235,7.313,1.735,1.735,0,0,1,7.971,9.048Z"/>
                                    <path id="Контур_3" data-name="Контур 3" d="M7.971,26.485A1.735,1.735,0,1,1,6.235,24.75a1.735,1.735,0,0,1,1.735,1.735Z" transform="translate(0 -2.068)"/>
                                    <path id="Контур_4" data-name="Контур 4" d="M28.236,16.875h-14.9a.992.992,0,0,0,0,1.983h14.9a.992.992,0,0,0,0-1.983Z" transform="translate(-0.93 -1.134)"/>
                                    <path id="Контур_5" data-name="Контур 5" d="M28.236,25.594h-14.9a.992.992,0,0,0,0,1.983h14.9a.992.992,0,0,0,0-1.983Z" transform="translate(-0.93 -2.168)"/>
                                    <path id="Контур_6" data-name="Контур 6" d="M13.331,10.139h14.9a.992.992,0,0,0,0-1.983h-14.9a.992.992,0,0,0,0,1.983Z" transform="translate(-0.93 -0.1)"/>
                                    </g>
                                </svg>

                            </button>

                            <button id="olBtnCurrent">

                                <svg xmlns="http://www.w3.org/2000/svg" width="23.717" height="25.685" viewBox="0 0 23.717 25.685">
                                    <g id="Icon_ionic-ios-list" data-name="Icon ionic-ios-list" transform="translate(-4.549 -3.733)">
                                    <path id="Контур_1" data-name="Контур 1" d="M6.235,16.031Z" transform="translate(0 -1.034)"/>
                                    <path id="Контур_4" data-name="Контур 4" d="M28.236,16.875h-14.9a.992.992,0,0,0,0,1.983h14.9a.992.992,0,0,0,0-1.983Z" transform="translate(-0.93 -1.134)"/>
                                    <path id="Контур_5" data-name="Контур 5" d="M28.236,25.594h-14.9a.992.992,0,0,0,0,1.983h14.9a.992.992,0,0,0,0-1.983Z" transform="translate(-0.93 -2.168)"/>
                                    <path id="Контур_6" data-name="Контур 6" d="M13.331,10.139h14.9a.992.992,0,0,0,0-1.983h-14.9a.992.992,0,0,0,0,1.983Z" transform="translate(-0.93 -0.1)"/>
                                    <text id="_2" data-name="2" transform="translate(4.549 27.417)" font-size="8" font-family="SG"><tspan x="0" y="0">3</tspan></text>
                                    <text id="_2-2" data-name="2" transform="translate(4.549 11.733)" font-size="8" font-family="SG"><tspan x="0" y="0">1</tspan></text>
                                    </g>
                                    <text id="_2-3" data-name="2" transform="translate(0 15.842)" font-size="8" font-family="SG"><tspan x="0" y="0">2</tspan></text>
                                </svg>

                            </button>
                            
                            <button id="photoBtnCurrent">

                                <svg xmlns="http://www.w3.org/2000/svg" width="28px" height="28px" viewBox="0 0 24 24" fill="none">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M1.93334 6.47005C1.93334 3.96453 3.96446 1.93341 6.46998 1.93341H17.5299C20.0354 1.93341 22.0665 3.96453 22.0665 6.47005V8.31337V17.53C22.0665 20.0355 20.0354 22.0666 17.5299 22.0666L8.3133 22.0666L6.46997 22.0666C3.96446 22.0666 1.93334 20.0355 1.93334 17.53V12.0198C1.93303 12.0067 1.93303 11.9935 1.93334 11.9804V6.47005ZM20.3665 6.47005V7.48245C15.4573 7.70571 12.2527 9.86213 10.2708 12.5638C7.97192 10.7456 5.3558 10.6106 3.63334 10.9059V6.47005C3.63334 4.90342 4.90334 3.63341 6.46998 3.63341H17.5299C19.0965 3.63341 20.3665 4.90342 20.3665 6.47005ZM3.63334 17.53V12.636C4.97128 12.3342 7.33257 12.3323 9.35002 14.0066C8.14528 16.1862 7.61609 18.5212 7.49255 20.3666H6.46997C4.90334 20.3666 3.63334 19.0966 3.63334 17.53ZM11.1527 14.2924C9.88823 16.3243 9.33147 18.5993 9.19679 20.3666H17.5299C19.0965 20.3666 20.3665 19.0966 20.3665 17.53V9.18438C15.5975 9.42387 12.7791 11.679 11.1527 14.2924ZM7.85247 8.31337C8.616 8.31337 9.23496 7.69441 9.23496 6.93088C9.23496 6.16735 8.616 5.54839 7.85247 5.54839C7.08894 5.54839 6.46998 6.16735 6.46998 6.93088C6.46998 7.69441 7.08894 8.31337 7.85247 8.31337Z" fill="#1C1C1C"/>
                                </svg>

                            </button>
                            
                            <button id="folderBtnCurrent">

                                <svg xmlns="http://www.w3.org/2000/svg" width="21.364" height="23.313" viewBox="0 0 21.364 23.313">
                                    <g id="Сгруппировать_1" data-name="Сгруппировать 1" transform="translate(-68 461.1)">
                                    <path id="Контур_1" data-name="Контур 1" d="M68-449.349V-437.7h2.444V-461H68Z" transform="translate(0 -0.094)"></path>
                                    <path id="Контур_2" data-name="Контур 2" d="M137-449.443v11.657l7.121-.017,7.116-.017.438-.148a3.994,3.994,0,0,0,2.489-2.307c.29-.767.29-.642.273-9.4-.023-9.156.017-8.36-.455-9.315a3.938,3.938,0,0,0-2.347-1.938c-.392-.131-.449-.131-3.166-.154L145.7-461.1l-.011,4.354-.017,4.359-1.176-.943c-.648-.517-1.193-.943-1.211-.943s-.563.426-1.211.943l-1.176.943-.017-4.353-.011-4.353H137Z" transform="translate(-65.078 0)"></path>
                                    </g>
                                </svg>

                            </button>

                        </div>

                    </div>

                    <div class="current-note-folders-form">

                        <input 
                            type="text"
                            id="newNoteFolderUIDS"
                            hidden />

                        <input 
                            type="text"
                            class="folder-search"
                            placeholder="Название блокнотика"
                            maxlength="50">

                        <span class="folder-title"><b>Блокнотики заметки</b></span>

                        <div class="folder-list"></div>

                        <form>

                            <input 
                                type="text" 
                                name="t" 
                                id="searchFolderTitle" 
                                hidden />

                            <button
                                id="createFolderInNote"
                                hx-post="{% url 'app:create-folder' %}"
                                hx-target=".folders">Создать</button>

                        </form>

                    </div>
                    
                    <!-- New photo form -->
                    <form 
                        hx-encoding="multipart/form-data"
                        hx-post="{% url 'app:upload-photo-to-note' %}"
                        hx-target="#photosCurrent">
                    
                        <input type="text" name="i" class="current-note-uid" hidden />
                        <input type="file" name="p" id="currentNotePhotoInput" hidden />
                        <button type="submit" id="currentNotePhotoSubmit" style="display: none;"></button>

                    </form>

                    <div class="content">

                        <div contenteditable="true" 
                            class="current-note-content"
                            placeholder="Я помню чудное мгновенье..."></div>

                    </div>

                    <div class="current-note-folders"></div>

                    <div id="currentNoteContents">{% include 'components/current-note.html' %}</div>

                </div>
                
            </div>

            <!-- Premium offer pop-up -->
            <div class="premium">

                <div class="wrapper">



                </div>

            </div>

            <div class="topnav">

                <div class="toggle-sidenav">

                    <div id="toggleSidenavBtn">

                        <svg xmlns="http://www.w3.org/2000/svg" width="19.394" height="28.21" viewBox="0 0 19.394 28.21">
                            <path id="Icon_awesome-lightbulb" data-name="Icon awesome-lightbulb" d="M5.293,25.033a1.764,1.764,0,0,0,.3.975l.942,1.415A1.763,1.763,0,0,0,8,28.21h3.4a1.763,1.763,0,0,0,1.468-.787l.942-1.415a1.762,1.762,0,0,0,.3-.975l0-2.113H5.29l0,2.113ZM0,9.7a9.643,9.643,0,0,0,2.4,6.379,15.834,15.834,0,0,1,2.877,5.039c0,.014.006.043.006.043h8.829c0-.014,0-.028.006-.043a15.834,15.834,0,0,1,2.877-5.039A9.7,9.7,0,1,0,0,9.7ZM9.7,5.289A4.413,4.413,0,0,0,5.289,9.7a.882.882,0,0,1-1.763,0A6.178,6.178,0,0,1,9.7,3.526a.882.882,0,0,1,0,1.763Z" transform="translate(0 0)"></path>
                        </svg>

                    </div>

                </div>

                <div class="search-notes">

                    <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="23.835" height="23.841" viewBox="0 0 23.835 23.841">
                        <path id="Icon_ionic-ios-search" data-name="Icon ionic-ios-search" d="M4.78,26.609l6.629-6.691a9.447,9.447,0,1,1,1.434,1.452L6.257,28.018a1.02,1.02,0,0,1-1.44.037A1.027,1.027,0,0,1,4.78,26.609ZM18.832,21.45a7.46,7.46,0,1,0-5.276-2.185A7.414,7.414,0,0,0,18.832,21.45Z" transform="translate(-4.5 -4.493)"/>
                    </svg>

                    <form>

                        <!-- Folder query -->
                        <input 
                            type="text" 
                            name="f" 
                            class="folderSearch"
                            hidden />

                        <!-- Note title/content query -->
                        <input 
                            type="text"
                            id="noteSearch" 
                            name="q" 
                            placeholder="Искать заметку"
                            hx-post="{% url 'app:search' %}"
                            hx-target=".notes"
                            hx-trigger="input changed delay:0.25s">

                        <!-- Note section queries -->

                            <!-- Loved -->
                        <input 
                            type="checkbox" 
                            name="l" 
                            class="loved-search"
                            hidden />

                            <!-- Archived -->
                        <input 
                            type="checkbox" 
                            name="a" 
                            class="archive-search"
                            hidden />

                            <!-- Trash search -->
                        <input 
                            type="checkbox" 
                            name="t" 
                            class="trash-search"
                            hidden />
                            
                    </form>

                    <form>

                        <!-- Folder query -->
                        <input 
                            type="text" 
                            name="f" 
                            class="folderSearch"
                            hidden />
                    
                        <!-- Note section queries -->

                            <!-- Loved -->
                        <input 
                            type="checkbox" 
                            name="l" 
                            class="loved-search"
                            hidden />

                            <!-- Archived -->
                        <input 
                            type="checkbox" 
                            name="a" 
                            class="archive-search"
                            hidden />

                            <!-- Trash search -->
                        <input 
                            type="checkbox" 
                            name="t" 
                            class="trash-search"
                            hidden />

                        <button 
                            hx-post="{% url 'app:cancel-search' %}"
                            hx-target=".notes"
                            hx-trigger="click delay:0.5s"
                            id="cancelSearch">×</button>
                    
                    </form>

                </div>

                <div class="mode">

                    <label class="toggle-mode">
                        {% if profile.dark_mode %}
                        
                            <input class='toggle-checkbox' id="modeCB" type='checkbox' checked></input>

                            <script>

                                $('body').addClass('dark');

                            </script>

                        {% else %}

                            <input class='toggle-checkbox' id="modeCB" type='checkbox'></input>

                        {% endif %}
                        <div class='toggle-slot'>
                        <div class='sun-icon-wrapper'>
                            <div class="iconify sun-icon" data-icon="feather-sun" data-inline="false"></div>
                        </div>
                        <div class='toggle-button'></div>
                        <div class='moon-icon-wrapper'>
                            <div class="iconify moon-icon" data-icon="feather-moon" data-inline="false"></div>
                        </div>
                        </div>
                    </label>

                </div>

                <div class="profile">

                    <div class="initials">

                        <span>{{ profile.initials }}</span>

                    </div>

                </div>

            </div>

            <div class="sidenav">

                <div 
                    class="page active"
                    id="homeSection"
                    hx-get="{% url 'app:home' %}"
                    hx-target=".notes"
                    hx-trigger="click delay:0.5s">

                    <div class="icon">

                        <svg class="home" xmlns="http://www.w3.org/2000/svg" width="29.174" height="25.726" viewBox="0 0 29.174 25.726">
                            <path id="Icon_material-home" data-name="Icon material-home" d="M14.192,28.373c1.755-2.106-1.4-6.319,0-8.426a3.286,3.286,0,0,1,5.617,0c1.4,2.106-1.755,6.319,0,8.426s5.266,2.809,7.022,0,0-11.234,0-11.234,6.67,3.16,4.213,0S24.023,4.5,17,4.5,5.416,13.979,2.958,17.139s4.213,0,4.213,0-1.755,8.426,0,11.234S12.437,30.48,14.192,28.373Z" transform="translate(-2.414 -4.5)"/>
                        </svg>

                    </div>

                    <span class="page-title">Домашняя</span>

                </div>

                <div 
                    class="page" 
                    id="lovedSection"
                    hx-get="{% url 'app:loved' %}"
                    hx-target=".notes"
                    hx-trigger="click delay:0.5s">

                    <div class="icon">

                        <svg style="fill: #e31b23; padding-top: 2px;" xmlns="http://www.w3.org/2000/svg" width="24.806" height="21.933" viewBox="0 0 24.806 21.933">
                            <path id="Icon_awesome-heart" data-name="Icon awesome-heart" d="M22.4,3.747a6.576,6.576,0,0,0-9.04.666l-.954.994-.954-.994a6.576,6.576,0,0,0-9.04-.666,7.08,7.08,0,0,0-.48,10.178L11.3,23.707a1.508,1.508,0,0,0,2.195,0l9.375-9.781A7.076,7.076,0,0,0,22.4,3.747Z" transform="translate(0.001 -2.248)"/>
                        </svg>

                    </div>

                    <span class="page-title" style="color: #e31b23;">Любимое</span>

                </div>

                <div class="page" id="newFolderInit">

                    <div class="icon">

                        <span>+</span>

                    </div>

                    <span class="page-title">Новый блокнотик</span>

                </div>

                <div class="folders">{% include 'components/folders.html' %}</div>

                <div 
                    class="page"
                    id="archiveSection"
                    hx-get="{% url 'app:archive' %}"
                    hx-target=".notes"
                    hx-trigger="click delay:0.5s">

                    <div class="icon">

                        <svg xmlns="http://www.w3.org/2000/svg" width="25.015" height="22.657" viewBox="0 0 25.015 22.657">
                            <g id="Icon_ionic-ios-archive" data-name="Icon ionic-ios-archive" transform="translate(-3.375 -4.5)">
                            <path id="Контур_1" data-name="Контур 1" d="M28.149,7.761H3.616a.238.238,0,0,1-.241-.233V6.363A1.892,1.892,0,0,1,5.3,4.5H26.465A1.892,1.892,0,0,1,28.39,6.363V7.528A.238.238,0,0,1,28.149,7.761Z"/>
                            <path id="Контур_2" data-name="Контур 2" d="M27.169,10.266H4.982a.476.476,0,0,0-.482.466V25.988a1.9,1.9,0,0,0,1.929,1.863H25.722a1.9,1.9,0,0,0,1.929-1.863V10.731A.476.476,0,0,0,27.169,10.266ZM19.09,18.534h-6a.856.856,0,0,1-.862-.716.826.826,0,0,1,.838-.914h6a.856.856,0,0,1,.862.716A.829.829,0,0,1,19.09,18.534Z" transform="translate(-0.193 -0.694)"/>
                            </g>
                        </svg>

                    </div>

                    <span class="page-title">Архив</span>

                </div>

                <div 
                    class="page"
                    id="trashSection"
                    hx-get="{% url 'app:trash' %}"
                    hx-target=".notes"
                    hx-trigger="click delay:0.5s">

                    <div class="icon">

                        <svg xmlns="http://www.w3.org/2000/svg" width="18.008" height="24.68" viewBox="0 0 18.008 24.68">
                            <g id="Icon_ionic-ios-trash" data-name="Icon ionic-ios-trash" transform="translate(-8.297 -4.5)">
                            <path id="Контур_3" data-name="Контур 3" d="M9.359,9l1.525,20.44a1.981,1.981,0,0,0,1.894,2.06h9.114a1.981,1.981,0,0,0,1.894-2.06L25.292,9ZM13.34,27.633,12.907,11.25h1.2l.446,16.383Zm4.544,0H16.721V11.25h1.164Zm3.381,0h-1.2L20.5,11.25h1.2Z" transform="translate(0 -2.32)"/>
                            <path id="Контур_4" data-name="Контур 4" d="M24.347,6.469H22L20.283,4.852a1.269,1.269,0,0,0-.861-.352H15.193a1.288,1.288,0,0,0-.874.352L12.6,6.469H10.254A1.733,1.733,0,0,0,8.3,8.3H26.3A1.733,1.733,0,0,0,24.347,6.469Z"/>
                            </g>
                        </svg>

                    </div>

                    <span class="page-title">Корзина</span>

                </div>

            </div>
            
            <!-- New note form -->
            <div class="new-note">

                <div class="wrapper">

                    <div class="top">

                        <div class="filters">

                            <div id="newNoteLove">

                                <svg style="padding-top: 2px;" xmlns="http://www.w3.org/2000/svg" width="24.806" height="21.933" viewBox="0 0 24.806 21.933">
                                    <path id="Icon_awesome-heart" data-name="Icon awesome-heart" d="M22.4,3.747a6.576,6.576,0,0,0-9.04.666l-.954.994-.954-.994a6.576,6.576,0,0,0-9.04-.666,7.08,7.08,0,0,0-.48,10.178L11.3,23.707a1.508,1.508,0,0,0,2.195,0l9.375-9.781A7.076,7.076,0,0,0,22.4,3.747Z" transform="translate(0.001 -2.248)"/>
                                </svg>

                            </div>

                            <div id="newNotePin">

                                <svg xmlns="http://www.w3.org/2000/svg" width="23.858" height="23.858" viewBox="0 0 23.858 23.858">
                                    <path id="Icon_simple-pinboard" data-name="Icon simple-pinboard" d="M10.585,14.5l4.482,4.587-.716-4.038,6.1-7.522,3.408.182L16.323,0V2.936L9.152,9.542l-4.486-1.1L9.326,13.4,0,23.858,10.585,14.5Z"/>
                                </svg>

                            </div>

                        </div>

                        <input 
                            type="text" 
                            class="new-note-title"
                            placeholder="Я помню чудное мгновенье...">

                        <div id="closeNewNote">×</div>

                    </div>

                    <div class="rte"></div>

                    <div 
                        contenteditable="true" 
                        id="newNoteContentCE"
                        placeholder="Я помню чудное мгновенье..."></div>

                    <form id="newNoteData">

                        <!-- Sections -->

                        <input 
                            type="text" 
                            name="f" 
                            id="newNoteFolder" />

                        <input 
                            type="checkbox" 
                            name="ls" 
                            id="lovedSection" />

                        <input 
                            type="checkbox" 
                            name="as" 
                            class="archivedSection" />

                            <!-- Content -->
                        <input 
                            type="text" 
                            name='t' 
                            id="newNoteTitle" />
                    
                        <input 
                            type="text" 
                            name='c' 
                            id="newNoteContent" />

                            <!-- Filters -->
                        <input 
                            type="checkbox" 
                            name="l" 
                            id="newNoteLoved" />
        
                        <input 
                            type="checkbox" 
                            name="p" 
                            id="newNotePinned" />

                        <button 
                            class="create-note-btn"
                            hx-post="{% url 'app:create-note' %}"
                            hx-target=".notes">Создать</button>
        
                    </form>

                </div>

            </div>

            <!-- Notes -->
            <div class="notes">

                {% include 'components/notes.html' %}

            </div>

        </div>

    </body>

    <style>

        @font-face {

            font-family: Comfortaa;
            src: url("{% static 'fonts/Comfortaa.ttf' %}");

        }

        @font-face {

            font-family: SG;
            src: url("{% static 'fonts/ShowcardGothic.otf' %}");
        
        }

    </style>

    <!-- htmx csrf -->
    <script>

        document.body.addEventListener('htmx:configRequest', (event) => {

            event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';

        });

    </script>

    <!-- Mode -->
    <script>

        $('#modeCB').change(function() {

            $('body').toggleClass('dark')

            $.ajax({

                type: 'POST',

                url: "{% url 'user:toggle-mode' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',

                }

            });

        });

        

    </script>

    <!-- Profile -->
    <script>

        profileDropdownOpen = false;

        $('.profile').click(function() {

            $('.initials').toggleClass('active');

            if (profileDropdownOpen) {

                $('.profile-dropdown').animate({'opacity': 0}, 250);

                setTimeout(function() {

                    $('.profile-dropdown').hide();

                }, 250);

                profileDropdownOpen = false;

            } else {

                $('.profile-dropdown').show();
                $('.profile-dropdown').animate({'opacity': 1}, 250);

                profileDropdownOpen = true;

            }

        });

        $('#myAccount, #logout').click(function() {

            $(this).addClass('active');

            setTimeout(function() {

                $('.btn').removeClass('active');

            }, 250);

                /* Hide profile dropdown */
            $('.initials').removeClass('active');

            $('.profile-dropdown').animate({'opacity': 0}, 250);

            setTimeout(function() {

                $('.profile-dropdown').hide();

            }, 250);

            profileDropdownOpen = false;

        });

    </script>

    
    <!-- Sidenav -->
    <script>

        sidenavOpen = false;

        $('.sidenav').mouseenter(function() {

            if (!sidenavOpen) {toggleSidenav()}

            $('.sidenav').css('overflow-y', 'auto');
            
        });

        $('.sidenav').mouseleave(function() {

            if (!sidenavOpen) {toggleSidenav()}

            $('.sidenav').css('overflow-y', 'hidden');

        });

        function toggleSidenav() {

            if ($('.sidenav').hasClass('open')) {

                $('.sidenav').removeClass('open');

                $('.page-title').hide();
                $('.page-title').css('opacity', 0);

            } else {

                $('.sidenav').addClass('open');

                $('.page-title').show();
                $('.page-title').animate({'opacity': 1}, 750);


            }

        }

        $('#toggleSidenavBtn').click(function() {

            $(this).toggleClass('active');

            toggleSidenav();
            
            sidenavOpen = !sidenavOpen;

        });

        $('body').on('click', '#homeSection, #lovedSection, #folderSection, #archiveSection, #trashSection', function(e) {
        
            $('.page').removeClass('active');
            $(this).addClass('active');

            $('.notes').animate({'opacity': 0}, 500);

            setTimeout(function() {

                $('.notes').animate({'opacity': 1}, 500);

            });

        });

        $('body').on('click', '#newFolderInit', function() {

            $('#newFolderInit').addClass('active');

            setTimeout(function() {

                $('#newFolderInit').removeClass('active');

            }, 250);

        })

        /* Edit folder */

        $('body').on('click', '#editFolderBtn', function() {

            $(this).addClass('active');

            folderUID = $(this).siblings('#folderUID').val();
            folderTitle = $(this).siblings('.page-title').children('span').text();

            $('#editFolderTitle').val(folderTitle);
            $('#deleteFolderUID').val(folderUID);

            $('.edit-folder').css('display', 'flex');
            $('.edit-folder').animate({'opacity': 1}, 250);

        });

            /* Close form */
        $('body').on('click', '#closeEditFolderForm, .edit-folder-btn, .delete-folder-btn', function() {

            $('#editFolderBtn').removeClass('active');

            $('.edit-folder').animate({'opacity': 0}, 250);

            setTimeout(function() {

                $('.edit-folder').css('display', 'none');

            }, 250);

        });

            /* Redirect to home section if folder has been deleted */
        $('.delete-folder-btn').click(function() {

            document.getElementById('homeSection').click();

        })

    </script>

    <!-- Pop-ups -->

        <!-- Premium -->

    <script>

        $('.premium-btn').click(function() {

            

        });

    </script>

    <!-- Search notes -->
    <script>

        document.getElementById('noteSearch').addEventListener('input', function() {

            $('#cancelSearch').show();
            $('#cancelSearch').animate({'opacity': 1}, 250);

        }, false);

        $('body').on('click', '#cancelSearch', function() {

            $('#noteSearch').val('');
            $(this).animate({'opacity': 0}, 250);
            setTimeout(function() {

                $('#cancelSearch').hide();

            }, 250)   

        })

    </script>

    <!-- Folders -->
    <script>

        /* Creation */

            /* Form show */

        $('#newFolderInit').click(function() {

            $('#newFolderTitle').val('');
            $('.create-folder-btn').prop('disabled', true);

            $('.create-folder').css('display', 'flex');
            $('.create-folder').animate({'opacity': 1}, 250);

        });

            /* Form hide */

        $('#closeNewFolderForm, .create-folder-btn').click(function() {

            $('.create-folder').animate({'opacity': 0}, 250);

            setTimeout(function() {

                $('.create-folder').css('display', 'none');

            }, 250)

        });

            /* Folder title checks (emptiness) & (uniqueness) */

        document.getElementById('newFolderTitle').addEventListener('input', function() {
            
            if ($(this).val().trim().length === 0) {

                $('.create-folder-btn').prop('disabled', true);

            } else {

                newTitle = $(this).val();

                titleUnique = true;

                $('.folders').children('.page').each(function() {

                    title = $(this).children('.page-title').children('span').text();
                        
                    if (title == newTitle) {

                        titleUnique = false;

                    }

                });
                
                if (titleUnique) {

                    $('.create-folder-btn').prop('disabled', false);

                } else {

                    $('.create-folder-btn').prop('disabled', true);

                }        

            }

        }, false);

    </script>

    <!-- New note -->
    <script>

        /* Extension & Condensation */

        newNoteOpen = false;

        $('.new-note-title').focus(function() {

            if (!newNoteOpen) {

                $('.new-note').addClass('open');

                $('.new-note-title').attr('placeholder', 'Заголовок');
                $('#newNoteContentCE').focus();

                newNoteOpen = true;

            }

        });

        $('#closeNewNote').click(function() {

            $('.new-note').removeClass('open');
            $('.new-note-title').attr('placeholder', 'Я помню чудное мгновенье...');

            newNoteOpen = false;

        })

        /* Filters */

            /* UI */
        $('#newNoteLove, #newNotePin').click(function() {

            $(this).toggleClass('active');

        });

            /* Love */
        $('#newNoteLove').click(function() {

            $('#newNoteLoved').prop('checked', !$('#newNoteLoved').prop('checked'));

        });

            /* Pin */
        $('#newNotePinned').click(function() {

            $('#newNotePinned').prop('checked', !$('#newNotePinned').prop('checked'));

        });

        /* CE & input communication */

            /* Title */

        document.getElementsByClassName('new-note-title')[0].addEventListener('input', function() {

            $('#newNoteTitle').val($('.new-note-title').val());

        }, false);

            /* Content */
        document.getElementsByClassName('new-note-content')[0].addEventListener('input', function() {

            $('#newNoteContent').val($('#newNoteContentCE').html());

        }, false);        

    </script>

    <!-- Current note -->
    <script>

        /* Before window is closed */

        window.onbeforeunload = function() {

            if (noteChanged) {

                return 'Не уходите! Ваша заметка сохраняется.';

            }

        }

        window.onunload = function() {

            if (noteChanged) {

                return 'Не уходите! Ваша заметка сохраняется.';

            }

        }

        /* On note load */

        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target === document.getElementById('currentNoteContents')) {

                /* Paste data from GET request */

                    /* Text */
                $('.current-note-uid').val($('#currentNoteUID').val());
                $('.current-note-title').val($('#currentNoteTitle').val());
                $('.current-note-content').html($('#currentNoteContent').val());


                    /* Photos */
                if ($('#currentNotePhotos').children().length > 0) {

                    $('#photosCurrent').css('display', 'block');

                    $('#currentNotePhotos').children('.photo').each(function() {

                        $('#photosCurrent').append($(this));

                    });

                }



                    /* Folders  */
                noteFolders = [];
                
                if ($('#currentNoteFolders').children('.folder').length === 0) {

                    $('.current-note-folders').hide();

                } else {

                    $('.current-note-folders').show();

                    $('#currentNoteFolders').children('.folder').each(function() {

                        noteFolders.push($(this).children('input').val());
                        $(this).appendTo('.current-note-folders');

                    });

                }

                $('body').css('overflow', 'hidden');
                
                    /* Render the note */
                $('#currentNoteContents').hide();

                $('.current-note').css('display', 'flex');
                $('.current-note').animate({'opacity': 1}, 500);

                noteOpen = true;
                photoOpen = false;

            }
    
        });

        /* Autosave */

        var delay = (function(){
            var timer = 0;
            return function(callback, ms){
                clearTimeout (timer);
                timer = setTimeout(callback, ms);
            };
        })();

            /* Title */

        document.getElementsByClassName('current-note-title')[0].addEventListener('input', function() {

            title = $('.current-note-title').val();
            noteUID = $('.current-note-uid').val();

            noteChanged = true;

            delay(function() {

                if (noteOpen) {

                    $.ajax({

                        type: 'POST',

                        url: "{% url 'app:update-title' %}",

                        data: {

                            'csrfmiddlewaretoken': '{{ csrf_token }}',

                            't': title,
                            'u': noteUID,

                        }

                    });

                    noteChanged = false;

                }

            }, 2000);

            $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                if ($(this).children('.note-actions').children('#noteUID').val() == noteUID) {

                    $(this).children('.text').children('.title').text(title);

                }

            });

        }, false);

            /* Content */

        document.getElementsByClassName('current-note-content')[0].addEventListener('input', function() {

            content = $('.current-note-content').html();
            noteUID = $('.current-note-uid').val();

            noteChanged = true;

            delay(function() {

                if (noteOpen) {

                    $.ajax({

                        type: 'POST',

                        url: "{% url 'app:update-content' %}",

                        data: {

                            'csrfmiddlewaretoken': '{{ csrf_token }}',

                            'c': content,
                            'u': noteUID,

                        }

                    });

                    noteChanged = false;

                }

            }, 2000);

            $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                if ($(this).children('.note-actions').children('#noteUID').val() == noteUID) {

                    $(this).children('.text').children('.content').html(content);

                }

            });

        }, false);

        /* Photos */

            /* Trash icon on hover */

        $('body').on('mouseover', '.photo', function() {

            $(this).children('#removePhoto').animate({'opacity': 1}, 250);

        });
        
        $('body').on('mouseleave', '.photo', function() {

            $(this).children('#removePhoto').animate({'opacity': 0}, 250);

        });

            /* Display photos div on upload */

        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target === document.getElementById('photosCurrent')) {

                $('#photosCurrent').show();

            }
    
        });

            /* Full reso on click */

        $('body').on('click', '.photo', function(e) {

            if (e.target != document.getElementById('removePhoto')) {

                openedPhoto = $(this).children('img').clone();
                previousPhotos = $(this).prevAll();
                nextPhotos = $(this).nextAll();

                if (previousPhotos.length > 0) {$('#previousPhoto').show()}
                if (nextPhotos.length > 0) {$('#nextPhoto').show()}
                
                previousPhotos.each(function() {
                    
                    photo = $(this).children('img').clone();
                    photo.css('display', 'none');
                    photo.appendTo('.photo-carousel');
                    
                });
                
                openedPhoto.attr('id', 'currentPhoto');
                openedPhoto.appendTo('.photo-carousel');

                nextPhotos.each(function() {

                    photo = $(this).children('img').clone();
                    photo.css('display', 'none');
                    photo.appendTo('.photo-carousel');

                });

                $('.photo-carousel').css('display', 'flex');
                $('.photo-carousel').animate({'opacity': 1}, 250);

                photoOpen = true;
                

            }

        });

            /* Next & Previous photos logic */

        $('body').on('click', '#nextPhoto', function() {

            nextPhoto = $('#currentPhoto').next();

            nextPhoto.css('display', 'block');
            $('#currentPhoto').hide();

            $('#currentPhoto').attr('id', '');
            nextPhoto.attr('id', 'currentPhoto');

            $('#previousPhoto').show();

            if (nextPhoto.nextAll().length === 0) {$('#nextPhoto').hide()}

        });

        $('body').on('click', '#previousPhoto', function() {

            previousPhoto = $('#currentPhoto').prev();

            previousPhoto.css('display', 'block');
            $('#currentPhoto').hide();

            $('#currentPhoto').attr('id', '');
            previousPhoto.attr('id', 'currentPhoto');

            $('#nextPhoto').show();

            if (previousPhoto.prevUntil('button').length === 0) {$('#previousPhoto').hide()}

        });

            /* Close full reso on btn click/esc */

        function closePhotoCarousel() {

            $('.photo-carousel').animate({'opacity': 0}, 250);
            
            setTimeout(function() {

                $('#nextPhoto').hide();
                $('#previousPhoto').hide();

                $('.photo-carousel').hide();
                $('.photo-carousel').children('img').each(function(){$(this).remove()})

            }, 250);

            photoOpen = false;

        }

        $('body').on('click', '#closePhoto', function() {

            closePhotoCarousel();

        });

            /* Delete */

        $('body').on('click', '#removePhoto', function() {

            photoToRemove = $(this).parent();

            photoToRemove.animate({opacity: 0}, 500);

            setTimeout(function() {

                photoToRemove.remove();

                if ($('#photosCurrent').children().length === 0) {

                    $('#photosCurrent').hide();

                }

            }, 500);

            $.ajax({

                type: 'POST',

                url: "{% url 'app:delete-photo' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    
                    'n': $('.current-note-uid').val(),
                    'p': $(this).siblings('input').val(),

                },

            });

        });

        /* Remove folders */

        $('body').on('mouseover', '.folder', function() {

            $(this).children('#removeFolder').animate({'opacity': 1}, 250);

        });

        $('body').on('mouseleave', '.folder', function() {

            $(this).children('#removeFolder').animate({'opacity': 0}, 250);

        });

        $('body').on('click', '#removeFolder', function() {

            uid = $(this).siblings('#folderUID').val();
            folderTitle = $(this).siblings('span').text();

            noteFolders.pop(uid);
            folderSearchInit();

            folder = $(this).parent();
            folder.animate({'opacity': 0}, 250);

            setTimeout(function() {
                
                folder.remove();

                if ($('.current-note-folders').children('.folder').length === 0) {

                    $('.current-note-folders').hide();

                }
            
            }, 250);

            $.ajax({

                type: 'POST',

                url: "{% url 'app:remove-folder' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',

                    'f': $(this).siblings('#folderUID').val(),
                    'n': $('.current-note-uid').val(),

                }

            });

            $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                if ($(this).children('.note-actions').children('#noteUID').val() == $('.current-note-uid').val()) {

                    $(this).children('.folders').children('.folder').each(function() {
                        
                        if ($(this).children('.folder-title').text() == folderTitle) {

                            $(this).remove();

                        }

                    });

                    if ($(this).children('.folders').children('.folder').length === 0) {

                        $(this).children('.folders').remove();

                    }

                }

            });

        });

        /* Note folders search */

            /* init */

        folderSearchOpen = false;
        noteFolders = [];

        function folderSearchInit() {

            $('.folder-list').html('');

            $('.folders').children('.page').each(function() {

                uid = $(this).children('#folderUID').val();
                title = $(this).children('.page-title').children('span').text();
                    
                if (!noteFolders.includes(uid) && uid != '') {
                                                                
                    $('.folder-list').append(

                        `

                            <div id='noteFolder'>

                                <input type='text' value='` + uid + `'/>
                                <span class='title'>` + title + `</span>

                            </div>

                        `

                    );

                } else if (noteFolders.includes(uid)) {

                    $('.folder-list').prepend(

                        `

                            <div id='noteFolder' class='inNote'>

                                <input type='text' value='` + uid + `'/>
                                <span class='title'>` + title + ` </span>

                            </div>

                        `

                    );

                }

            });

        }

        $('body').on('click', '#noteFolder', function() {

            noteUID = $('.current-note-uid').val();

            uid = $(this).children('input').val();
            folderSearchTitle = $(this).children('span').text();

            if (!$(this).hasClass('inNote')) {

                $(this).addClass('inNote');

                $('.current-note-folders').show();

                $('.current-note-folders').append(

                    `

                        <div class='folder'>

                            <input
                                type='text'
                                value='` + uid + `'
                                hidden />

                            <span>` + folderSearchTitle + `</span>
                            <button id='removeFolder'>X</button

                        </div>

                    `

                );

                noteFolders.push(uid);

                $.ajax({

                    type: 'POST',

                    url: "{% url 'app:add-folder' %}",

                    data: {

                        'csrfmiddlewaretoken': '{{ csrf_token }}',

                        'f': uid,
                        'n': $('.current-note-uid').val(),

                    }
                    
                });

                $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                    if ($(this).children('.note-actions').children('#noteUID').val() == noteUID) {

                        if ($(this).children('.folders').length === 0) {

                            $(this).append(

                                `
                                    <div 
                                        class='folders'
                                        hx-get="/get-note/` + noteUID + `/"
                                        hx-target="#currentNoteContents"></div>

                                `

                            )

                        }

                        $(this).children('.folders').append(

                            `
                                <div class='folder'>
                                    <span class='folder-title'>` + folderSearchTitle + `</span>
                                </div>
                            `

                        )

                    }

                });

            } else {

                $(this).removeClass('inNote');

                $('.current-note-folders').children('.folder').each(function() {

                    if (uid == $(this).children('input').val()){$(this).remove()};

                });

                noteFolders.pop(uid);

                $.ajax({

                    type: 'POST',

                    url: "{% url 'app:remove-folder' %}",

                    data: {

                        'csrfmiddlewaretoken': '{{ csrf_token }}',

                        'f': uid,
                        'n': $('.current-note-uid').val(),

                    }
                    
                });

                if ($('.current-note-folders').children('.folder').length === 0) {

                    $('.current-note-folders').hide();

                }

                $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                    if ($(this).children('.note-actions').children('#noteUID').val() == $('.current-note-uid').val()) {

                        $(this).children('.folders').children('.folder').each(function() {
                            
                            if ($(this).children('.folder-title').text() == folderSearchTitle) {

                                $(this).remove();

                            }

                        });

                        if ($(this).children('.folders').children('.folder').length === 0) {

                            $(this).children('.folders').remove();

                        }

                    }

                });

            }

        });

            /* Form render */

        $('#folderBtnCurrent').click(function() {

            if (!folderSearchOpen) {

                $('.current-note-folders-form').css('display', 'block');
                $('.current-note-folders-form').animate({'opacity': 1}, 250);

                folderSearchInit();

                folderSearchOpen = true;

                $(this).addClass('active');

            } else {

                closeFolderSearch();

                $(this).removeClass('active');
                
            }

        });    

            /* Form remove */

        function closeFolderSearch() {

            $('.current-note-folders-form').animate({'opacity': 0}, 250);

            setTimeout(function() {
                
                $('.current-note-folders-form').css('display', 'none');

                $('.folder-search').val('');
                $('#searchFolderTitle').val('');
                $('#createFolderInNote').hide();
                $('.folder-list').html('');



            }, 250);

            folderSearchOpen = false;

            $('#folderBtnCurrent').removeClass('active');

        }

            /* Search */

        $('.folder-search').on('input', function() {

            folderExists = false;

            $('#searchFolderTitle').val($(this).val());

            $('.folder-list').html('');

            $('.folder-title').show();
            $('.folder-list').show();

            if ($(this).val().trim().length === 0) {

                $('#createFolderInNote').hide();

                folderSearchInit();

            } else {

                query = $(this).val();

                $('.folders').children('.page').each(function() {

                    uid = $(this).children('#folderUID').val();
                    title = $(this).children('.page-title').children('span').text().toString();

                    if (title === query) { /* Folder exists */

                        folderExists = true;

                    }

                    if (~title.indexOf(query)) {

                        if (noteFolders.includes(uid)) {

                            $('.folder-list').prepend(

                                `

                                    <div id='noteFolder'>

                                        <input type='text' value='` + uid + `' hidden />
                                        <input 
                                            type='checkbox' 
                                            id='newNoteFolderCheck' 
                                            onChange="addFolderToCurrentNote(this)"
                                            checked />
                                        <span>` + title + ` </span>

                                    </div>

                                `

                            );

                        } else {

                            $('.folder-list').prepend(

                                `

                                    <div id='noteFolder'>

                                        <input type='text' value='` + uid + `' hidden />
                                        <input 
                                            type='checkbox' 
                                            id='newNoteFolderCheck' 
                                            onChange="addFolderToCurrentNote(this)"
                                            />
                                        <span>` + title + ` </span>

                                    </div>

                                `

                            );

                        }

                    }

                });

                if (folderExists) {

                    $('#createFolderInNote').hide();
                
                } else {

                    $('#createFolderInNote').text("Создать '" + query + "'");
                    $('#createFolderInNote').show();

                }

                if ($('.folder-list').children('#noteFolder').length == 0) {
                    
                    $('.folder-title').hide();
                    $('.folder-list').hide();
                
                } else if ($('.folder-list').children('#noteFolder').length == 1) {

                    $('#noteFolder').css('margin', 0);

                } else {

                    $('#noteFolder').css('marginBottom', 15);

                }

            }

        });

            /* Sidenav folder opacity if open */

        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target == document.getElementsByClassName('folders')[0]) {

                if ($('.sidenav').hasClass('open')) {

                    $('.page-title').css('opacity', 1);

                }

            }

        })

            /* Creating folder from folder search */

        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target == document.getElementsByClassName('folders')[0] && noteOpen) {

                title = $('#searchFolderTitle').val();

                $('.folders').children('.page').each(function() {

                    if ($(this).children('.page-title').children('span').text() === title) {
                        
                        uid = $(this).children('#folderUID').val();

                        $('.current-note-folders').append(

                            `

                                <div class='folder'>

                                    <input
                                        type='text'
                                        value='` + uid + `'
                                        hidden />

                                    <span>` + title + `</span>
                                    <button id='removeFolder'>X</button

                                </div>

                            `

                        );

                        $.ajax({

                            type: 'POST',

                            url: "{% url 'app:add-folder' %}",

                            data: {

                                'csrfmiddlewaretoken': '{{ csrf_token }}',

                                'f': uid,
                                'n': $('.current-note-uid').val(),

                            }
                            
                        });

                        noteFolders.push(uid);

                    }

                });

                $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                    if ($(this).children('.note-actions').children('#noteUID').val() == $('.current-note-uid').val()) {

                        if ($(this).children('.folders').length > 0) {

                            $(this).children('.folders').append(

                                `
                                    <div class='folder'>
                                        
                                        <span class='folder-title'>` + title + `</span>

                                    </div>

                                `

                            )

                        } else {

                            $(this).append(`<div class='folders'></div>`);

                            $(this).children('.folders').append(

                                `
                                    <div class='folder'>
                                        
                                        <span class='folder-title'>` + title + `</span>

                                    </div>

                                `

                            )

                        }

                    }

                });

                $('#createFolderInNote').hide();
                $('.folder-search').val('');
                $('.folder-search').focus();

                $('.current-note-folders').show();

                $('.folder-title').show();
                $('.folder-list').show();

                folderSearchInit();

            }
    
        });

        /* Close note */

        function closeNote() {

            $('.current-note').animate({'opacity': 0}, 250);
            closeFolderSearch();

            $('#boldBtnCurrent').removeClass('active');
            $('#italicBtnCurrent').removeClass('active');
            $('#underlineBtnCurrent').removeClass('active');
            $('#strikeBtnCurrent').removeClass('active');
            $('#ulBtnCurrent').removeClass('active');
            $('#olBtnCurrent').removeClass('active');

            /* Autosave */

            $.ajax({

                type: 'POST',

                url: "{% url 'app:update-contents' %}",

                data: {

                    'csrfmiddlewaretoken': '{{csrf_token}}',

                    'u': $('.current-note-uid').val(),
                    't': $('.current-note-title').val(),
                    'c': $('.current-note-content').html(),

                }

            });

            noteChanged = false;

            noteUID = $('.current-note-uid').val();

            /* Empty condition */

            if (!$('.current-note-title').val() && !$('.current-note-content').html()) {

                $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                    if ($(this).children('.note-actions').children('#noteUID').val() == noteUID) {

                        $(this).children('.empty').show();

                    }

                });

            } else {

                $('.notes').children('.wrapper').children('.note-section').children('.note').each(function() {

                    if ($(this).children('.note-actions').children('#noteUID').val() == noteUID) {

                        $(this).children('.empty').hide();

                    }

                });

            }

            setTimeout(function() {

                $('.current-note').css('display', 'none');

                $('.current-note-title').val('');
                $('.current-note-content').html('');

                $('#photosCurrent').html('');
                $('#photosCurrent').hide();

                $('.current-note-folders').html('');
            
            }, 250);

            noteOpen = false;

            $('body').css('overflow-y', 'auto');

        }

        $('#closeCurrentNote').click(function() {

            $(this).addClass('active');
            setTimeout(function() {$('#closeCurrentNote').removeClass('active')}, 250);

            closeNote();

        });

        $('body').click(function(e) {

            if (noteOpen && $(e.target).is('.current-note')) {

                closeNote();

            }

        });

        $('body').keyup(function(e) {

            if (e.keyCode === 27) {

                if (window.opener && window.opener !== window) { /* We're in a pop-up */

                    console.log('p');

                } else {

                    if (noteOpen && !photoOpen) {

                        closeNote();

                    } else {

                        closePhotoCarousel();
                        photoOpen = false;

                    }

                }

            }

        });

    </script>

    <!-- Notes -->
    <script>

        $('body').on('click', '#cancelSearch', function() {

            $('.notes').animate({'opacity': 0}, 500);
            setTimeout(function() {

                $('.notes').animate({'opacity': 1}, 500);

            });

        });

        /* Note actions @hover */

        $('body').on('mouseover', '.note', function() {

            $(this).children('.note-actions').animate({'opacity': 1}, 250);
            $(this).children('.folders').css('overflow', 'auto');

        });

        $('body').on('mouseleave', '.note', function() {

            $(this).children('.note-actions').animate({'opacity': 0}, 250);
            $(this).children('.folders').css('overflow', 'hidden');

        });

        /* Note actions functionality */

        $('body').on('click', '#loveNote, #pinNote, #archiveNote, #deleteNote', function() {

            $(this).toggleClass('active');

        });

            /* Love */

        $('body').on('click', '#loveNote', function() {

            $.ajax({

                type: 'POST',

                url: "{% url 'app:love-note' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'n': $(this).siblings('#noteUID').val(),

                },

            });

        });

            /* Pin */

        $('body').on('click', '#pinNote', function() {

            note = $(this).parent().parent();

            if ($(this).hasClass('active')) { /* pin */

                if ($('#pinnedNotes').length) {

                    note.insertAfter($('#pinnedNotes').children('.section-title'));

                } else {

                    $(`<div class="note-section" id="pinnedNotes"><span class="section-title">Закрепленные заметки</span></div>`).insertAfter($('.note-section-title'))

                    note.insertAfter($('#pinnedNotes').children('.section-title'));
                    
                    if ($('#otherNotes').children('.note').length === 0) {

                        $('#otherNotes').remove();
                    
                    }

                }

                if ($('#otherNotes').children('.note').length === 0) {

                    $('#otherNotes').remove();

                }

                if ($('#otherNotes').children('.note').length > 0 && $('#otherNotes').children('.section-title').length === 0) {

                    $('#otherNotes').prepend(`<span class='section-title'>Другие заметки</span>`)

                }

            } else { /* unpin */

                if ($('#otherNotes').length) {

                    note.insertAfter($('#otherNotes').children('.section-title'));

                    if ($('#pinnedNotes').children('.note').length === 0) {
                        
                        $('#otherNotes').children('.section-title').remove();
                    
                    }

                } else {

                    if ($('#pinnedNotes').children('.note').length === 1) {

                        $('.notes').children('.wrapper').append(

                            `

                                <div class="note-section" id="otherNotes"></div>

                            `

                        );

                        note.appendTo('#otherNotes');

                    } else {

                        $('.notes').children('.wrapper').append(

                            `

                                <div class="note-section" id="otherNotes">

                                    <span class="section-title">Другие заметки</span>

                                </div>

                            `

                        );

                        note.insertAfter($('#otherNotes').children('.section-title'));

                    }

                }

                if ($('#pinnedNotes').children('.note').length === 0) {

                    $('#pinnedNotes').remove();

                }
            
            }

            $.ajax({

                type: 'POST',

                url: "{% url 'app:pin-note' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'n': $(this).siblings('#noteUID').val(),

                },

            });

        });

            /* Removing note section logic function */

        function pinLogic(pinned) {

            pinnedEmpty = false;
            otherEmpty = false;

            if (pinned) {

                if ($('#pinnedNotes').children('.note').length === 1) {

                    $('#pinnedNotes').animate({'opacity': 0}, 250);
                    pinnedEmpty = true;

                }

            } else {

                if ($('#otherNotes').children('.note').length === 1) {

                    $('#otherNotes').animate({'opacity': 0}, 250);
                    otherEmpty = true;

                }

            }

        }

            /* Archive */

        $('body').on('click', '#archiveNote', function() {

            note = $(this).parent().parent();
            pinned = $(this).siblings('#pinNote').hasClass('active');

            note.animate({'opacity': 0}, 250);
            
            pinLogic(pinned);

            setTimeout(function() {
                
                note.remove();

                if (pinnedEmpty && !otherEmpty) {

                    $('#pinnedNotes').remove();

                } else if (!pinnedEmpty && otherEmpty) {

                    $('#otherNotes').remove();

                }
            
            }, 250);

            
            $.ajax({

                type: 'POST',

                url: "{% url 'app:archive-note' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'n': $(this).siblings('#noteUID').val(),

                },

            });

        });

            /* Delete */

        $('body').on('click', '#deleteNote', function() {

            note = $(this).parent().parent();
            pinned = $(this).siblings('#pinNote').hasClass('active');
            
            pinLogic(pinned);

            setTimeout(function() {
                
                note.remove();

                if (pinnedEmpty && !otherEmpty) {

                    $('#pinnedNotes').remove();

                } else if (!pinnedEmpty && otherEmpty) {

                    $('#otherNotes').remove();

                }
            
            }, 250);

            
            $.ajax({

                type: 'POST',

                url: "{% url 'app:delete-note' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'n': $(this).siblings('#noteUID').val(),

                },

            });

        });

        /* Empty note */

        $('.note').each(function() {

            title = $(this).children('.text').children('.title').text();
            content = $(this).children('.text').children('.content').html();

            uid = $(this).children('.note-actions').children('#noteUID').val();

            if (title === '' && content == '') {

                $(this).children('.empty').show();

            }
                    
        });

        document.body.addEventListener('htmx:afterSwap', function(evt) {

            if (evt.detail.target === document.getElementsByClassName('notes')[0]) {

                $('.note').each(function() {

                    text = $(this).children('.text');

                    title = text.children('.title').text();
                    content = text.children('.content').html();

                    uid = $(this).children('.note-actions').children('#noteUID').val();

                    if (title === '' && content == '') {

                        $(this).children('.empty').show();

                    }
                    

                });

            }
    
        });

    </script>

    <!-- RTE -->
    <script>

        /* formatting check function */

        function styleCheck() {

            if (document.queryCommandState('bold')) {$('#boldBtnCurrent').addClass('active');} else {$('#boldBtnCurrent').removeClass('active');}
            if (document.queryCommandState('italic')) {$('#italicBtnCurrent').addClass('active');} else {$('#italicBtnCurrent').removeClass('active');}
            if (document.queryCommandState('underline')) {$('#underlineBtnCurrent').addClass('active');} else {$('#underlineBtnCurrent').removeClass('active');}
            if (document.queryCommandState('strikeThrough')) {$('#strikeBtnCurrent').addClass('active');} else {$('#strikeBtnCurrent').removeClass('active');}
            
            if (document.queryCommandState('insertUnorderedList')) {$('#ulBtnCurrent').addClass('active');} else {$('#ulBtnCurrent').removeClass('active');}
            if (document.queryCommandState('insertOrderedList')) {$('#olBtnCurrent').addClass('active');} else {$('#olBtnCurrent').removeClass('active');}

        }

        /* formatting check events */

        $('.current-note-content').keyup(function() {

            styleCheck();

        });

        $('.current-note-content').click(function() {

            styleCheck();

        });

        /* formatting */

        $('#boldBtnCurrent').click(function() {

            $('.current-note-content').focus();
            document.execCommand('bold');
            $('.current-note-content').focus();

            styleCheck();

        });

        $('#italicBtnCurrent').click(function() {

            $('.current-note-content').focus();
            document.execCommand('italic');
            $('.current-note-content').focus();

            styleCheck();

        });

        $('#underlineBtnCurrent').click(function() {
            
            $('.current-note-content').focus();
            document.execCommand('underline');
            $('.current-note-content').focus();

            styleCheck();

        });

        $('#strikeBtnCurrent').click(function() {
            
            $('.current-note-content').focus();
            document.execCommand('strikeThrough');
            $('.current-note-content').focus();

            styleCheck();

        });

        $('#ulBtnCurrent').click(function() {

            $('.current-note-content').focus();
            document.execCommand('insertUnorderedList');
            $('.current-note-content').focus();

            styleCheck();

        });

        $('#olBtnCurrent').click(function() {

            $('.current-note-content').focus();
            document.execCommand('insertOrderedList');
            $('.current-note-content').focus();
            
            styleCheck();

        });


        /* photo upload */

        $('#photoBtnCurrent').click(function() {

            $(this).addClass('active');
            setTimeout(function() {$('#photoBtnCurrent').removeClass('active')}, 200);

            $('#currentNotePhotoInput').click();

        });

        $('#currentNotePhotoInput').on('change', function() {

            $('#currentNotePhotoSubmit').click();

        });

    </script>

    <!-- Trash -->

    <script>

        $('body').on('click', '#emptyTrashBtn', function() {

            $.ajax({

                type: 'POST',

                url: "{% url 'app:empty-trash' %}",

                data: {

                    'csrfmiddlewaretoken': '{{ csrf_token }}',

                }

            })

        });

    </script>

</html>